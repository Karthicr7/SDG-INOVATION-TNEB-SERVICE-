<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Energy Saver Chatbot Widget</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    body { font-family: 'Poppins', sans-serif; margin: 0; }
    #chatWidgetBtn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #00ffcc;
      color: #000;
      border: none;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      font-size: 30px;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(0,255,204,0.6);
    }
    #chatWidget {
      position: fixed;
      bottom: 90px;
      right: 20px;
      width: 320px;
      height: 450px;
      background: linear-gradient(145deg,#1e1e2f,#27293d);
      border-radius: 20px;
      border: 2px solid #00ffcc;
      display: none;
      flex-direction: column;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0,255,200,0.3);
    }
    #chatHeader {
      background: #00ffcc;
      color: #000;
      text-align: center;
      font-weight: bold;
      padding: 10px;
    }
    #langSelect {
      width: 95%;
      margin: 5px auto;
      padding: 5px;
      background: #222;
      color: #fff;
      border: none;
      font-size: 14px;
      display: block;
      border-radius: 5px;
    }
    #chatBox {
      flex: 1;
      padding: 8px;
      overflow-y: auto;
    }
    .message {
      margin: 6px 0;
      padding: 8px 12px;
      border-radius: 12px;
      max-width: 75%;
      line-height: 1.4;
      word-wrap: break-word;
    }
    .user {
      background: #1e90ff;
      color: #fff;
      margin-left: auto;
      text-align: right;
    }
    .bot {
      background: #333;
      color: #00ffcc;
      margin-right: auto;
    }
    .typing {
      font-style: italic;
      color: #aaa;
      margin: 5px 0;
    }
    #chatInputContainer {
      display: flex;
      border-top: 1px solid #444;
    }
    #chatInput {
      flex: 1;
      padding: 10px;
      border: none;
      outline: none;
      font-size: 14px;
      background: #222;
      color: #fff;
    }
    #sendBtn {
      padding: 10px 12px;
      border: none;
      background: #00ffcc;
      color: #000;
      font-weight: bold;
      cursor: pointer;
    }
    #sendBtn:hover {
      background: #00cc99;
    }
  </style>
</head>

<body>

  <button id="chatWidgetBtn">ЁЯТб</button>

  <div id="chatWidget">
    <div id="chatHeader">Energy Saver Bot</div>
    <select id="langSelect">
      <option value="en">English</option>
      <option value="ta">Tamil</option>
      <option value="hi">Hindi</option>
    </select>
    <div id="chatBox"></div>
    <div id="chatInputContainer">
      <input type="text" id="chatInput" placeholder="Ask me something..." />
      <button id="sendBtn">Send</button>
    </div>
  </div>

  <script>
    const chatBtn = document.getElementById('chatWidgetBtn');
    const chatWidget = document.getElementById('chatWidget');
    chatBtn.addEventListener('click', () => {
      chatWidget.style.display = chatWidget.style.display === 'flex' ? 'none' : 'flex';
      chatWidget.style.flexDirection = 'column';
    });

    const responses = [
      {
        keywords: ["save electricity in summer"],
        reply: {
          en: ["тШАя╕П Tips for summer electricity saving:", "тЬЕ Use fans instead of AC", "ЁЯМб Keep AC temperature 24тАУ26┬░C", "ЁЯкЯ Close curtains", "ЁЯз║ Use washing machines at night"],
          ta: ["тШАя╕П роХрпЛроЯрпИ рооро╛роЪродрпНродро┐ро▓рпН рооро┐ройрпНроЪро╛ро░родрпНродрпИ роЪрпЗрооро┐рокрпНрокродро▒рпНроХро╛рой роХрпБро▒ро┐рокрпНрокрпБроХро│рпН:", "тЬЕ ACроХрпНроХрпБрокрпН рокродро┐ро▓ро╛роХ ро╡ро┐роЪро┐ро▒ро┐роХро│рпИ рокропройрпНрокроЯрпБродрпНродро╡рпБроорпН", "ЁЯМб AC ро╡рпЖрокрпНрокроиро┐ро▓рпИ 24тАУ26┬░C ро╡рпИроХрпНроХро╡рпБроорпН", "ЁЯкЯ ┘╛╪▒╪про░рпИроХро│рпН роорпВроЯро╡рпБроорпН", "ЁЯз║ роЗро░ро╡ро┐ро▓рпН родрпБро╡рпИроХрпНроХрпБроорпН роЗропроирпНродро┐ро░роЩрпНроХро│рпИ рокропройрпНрокроЯрпБродрпНродро╡рпБроорпН"],
          hi: ["тШАя╕П рдЧрд░реНрдореА рдореЗрдВ рдмрд┐рдЬрд▓реА рдмрдЪрд╛рдиреЗ рдХреЗ рдЙрдкрд╛рдп:", "тЬЕ AC рдХреА рдЬрдЧрд╣ рдкрдВрдЦреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ", "ЁЯМб AC рддрд╛рдкрдорд╛рди 24тАУ26┬░C рд░рдЦреЗрдВ", "ЁЯкЯ рдкрд░реНрджреЗ рдмрдВрдж рдХрд░реЗрдВ", "ЁЯз║ рд░рд╛рдд рдореЗрдВ рд╡реЙрд╢рд┐рдВрдЧ рдорд╢реАрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ"]
        }
      },
      {
        keywords: ["how to pay eb bill", "pay electricity bill", "eb bill payment"],
        reply: {
          en: ["ЁЯТб You can check your EB Bill Status here:", "ЁЯФЧ https://www.tnpdcl.gov.in/BillStatus/billstatus.xhtml"],
          ta: ["ЁЯТб роЙроЩрпНроХро│рпН рооро┐ройрпНроЪро╛ро░роХрпН роХрогроХрпНроХрпИ роЗроЩрпНроХрпЗ рокро╛ро░рпНроХрпНроХро▓ро╛роорпН:", "ЁЯФЧ https://www.tnpdcl.gov.in/BillStatus/billstatus.xhtml"],
          hi: ["ЁЯТб рдЖрдк рдЕрдкрдирд╛ рдмрд┐рдЬрд▓реА рдмрд┐рд▓ рдпрд╣рд╛рдБ рдЪреЗрдХ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:", "ЁЯФЧ https://www.tnpdcl.gov.in/BillStatus/billstatus.xhtml"]
        }
      },
      {
        keywords: ["eb customer care number", "eb helpline", "electricity helpline"],
        reply: {
          en: ["ЁЯУЮ EB Customer Care Number: 1800-425-1234"],
          ta: ["ЁЯУЮ рооро┐ройрпН ро╡ро╛роЯро┐роХрпНроХрпИропро╛ро│ро░рпН роХрпЗро░рпНроироорпНрокро░рпН: 1800-425-1234"],
          hi: ["ЁЯУЮ рдмрд┐рдЬрд▓реА рдЧреНрд░рд╛рд╣рдХ рд╕реЗрд╡рд╛ рдирдВрдмрд░: 1800-425-1234"]
        }
      },
      {
        keywords: ["eb complaint number", "eb grievance", "eb support number"],
        reply: {
          en: ["ЁЯУЮ For complaints, call: 94443-12345"],
          ta: ["ЁЯУЮ рокрпБроХро╛ро░рпНроХро│рпН рокродро┐ро╡рпБ роОрогрпН: 94443-12345"],
          hi: ["ЁЯУЮ рд╢рд┐рдХрд╛рдпрдд рд╣реЗрддреБ рдирдВрдмрд░: 94443-12345"]
        }
      },
      {
        keywords: ["eb technical support", "eb emergency number", "eb outage support"],
        reply: {
          en: ["тЪб In case of outage or technical support, call: 94444-67890"],
          ta: ["тЪб рооро┐ройрпН роЪрпЗро╡рпИ роХрпБро▒рпИрокро╛роЯрпБроХро│рпН роЕро▓рпНро▓родрпБ роЖрокродрпНродрпБроХро╛ро▓ роЙродро╡ро┐: 94444-67890"],
          hi: ["тЪб рддрдХрдиреАрдХреА рд╕рд╣рд╛рдпрддрд╛ рдпрд╛ рдЖрдкрд╛рддрдХрд╛рд▓реАрди рд╕реНрдерд┐рддрд┐ рд╣реЗрддреБ: 94444-67890"]
        }
      },
      {
        keywords: ["save electricity in winter"],
        reply: {
          en: ["тЭДя╕П Winter electricity saving tips:", "ЁЯЫП Use blankets instead of heaters", "тШАя╕П Use sunlight", "ЁЯФМ Turn off unused electronics"],
          ta: ["тЭДя╕П роХрпБро│ро┐ро░рпНроХро╛ро▓родрпНродро┐ро▓рпН рооро┐ройрпНроЪро╛ро░ роЪрпЗрооро┐рокрпНрокрпБ:", "ЁЯЫП ро╣рпАроЯрпНроЯро░рпН рокродро┐ро▓ро╛роХ роХроорпНрокро│ро┐роХро│рпН рокропройрпНрокроЯрпБродрпНродро╡рпБроорпН", "тШАя╕П роЪрпВро░ро┐роп роТро│ро┐ропрпИ рокропройрпНрокроЯрпБродрпНродро╡рпБроорпН", "ЁЯФМ рокропройрпНрокроЯро╛род роЪро╛родройроЩрпНроХро│рпИ роЕрогрпИроХрпНроХро╡рпБроорпН"],
          hi: ["тЭДя╕П рд╕рд░реНрджреА рдореЗрдВ рдмрд┐рдЬрд▓реА рдмрдЪрд╛рдиреЗ рдХреЗ рдЙрдкрд╛рдп:", "ЁЯЫП рд╣реАрдЯрд░ рдХреА рдЬрдЧрд╣ рдХрдВрдмрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ", "тШАя╕П рд╕реВрд░рдЬ рдХреА рд░реЛрд╢рдиреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ", "ЁЯФМ рдЕрдиреБрдкрдпреЛрдЧреА рдЙрдкрдХрд░рдг рдмрдВрдж рдХрд░реЗрдВ"]
        }
      },
      {
        keywords: ["save electricity", "electricity saving", "tips"],
        reply: {
          en: ["ЁЯТб General electricity saving tips:", "тЬЕ Switch off Fan, AC, Lights when not in use", "ЁЯТб Use LED bulbs", "ЁЯФМ Unplug chargers", "тЪб Use energy-efficient devices"],
          ta: ["ЁЯТб рокрпКродрпБро╡ро╛рой рооро┐ройрпНроЪро╛ро░ роЪрпЗрооро┐рокрпНрокрпБ:", "тЬЕ ро╡ро┐роЪро┐ро▒ро┐, AC, ро╡ро┐ро│роХрпНроХрпБроХро│рпИ роЕрогрпИроХрпНроХро╡рпБроорпН", "ЁЯТб LED ро╡ро┐ро│роХрпНроХрпБроХро│рпН рокропройрпНрокроЯрпБродрпНродро╡рпБроорпН", "ЁЯФМ роЪро╛ро░рпНроЬро░рпНроХро│рпН роЕроХро▒рпНро▒ро╡рпБроорпН", "тЪб рооро┐ройрпНроЪро╛ро░ роЪрпЗрооро┐рокрпНрокрпБроХрпН роХро░рпБро╡ро┐роХро│рпН"],
          hi: ["ЁЯТб рд╕рд╛рдорд╛рдиреНрдп рдмрд┐рдЬрд▓реА рдмрдЪрд╛рдиреЗ рдХреЗ рд╕реБрдЭрд╛рд╡:", "тЬЕ рдкрдВрдЦрд╛, AC, рд▓рд╛рдЗрдЯ рдмрдВрдж рдХрд░реЗрдВ", "ЁЯТб LED рдмрд▓реНрдм", "ЁЯФМ рдЪрд╛рд░реНрдЬрд░ рдЕрдирдкреНрд▓рдЧ рдХрд░реЗрдВ", "тЪб рдКрд░реНрдЬрд╛-рдХреБрд╢рд▓ рдЙрдкрдХрд░рдг"]
        }
      },
      {
        keywords: ["what fan to use", "best fan", "fan type"],
        reply: {
          en: ["ЁЯМА Use ceiling fans or energy-efficient BLDC fans", "тЬЕ They consume less electricity and cool better"],
          ta: ["ЁЯМА роЪро┐ро▓рпНро▓ро┐роЩрпН ро╡ро┐роЪро┐ро▒ро┐ роЕро▓рпНро▓родрпБ BLDC ро╡ро┐роЪро┐ро▒ро┐ рокропройрпНрокроЯрпБродрпНродро╡рпБроорпН", "тЬЕ роЗродрпБ роХрпБро▒рпИроирпНрод рооро┐ройрпНроЪро╛ро░роорпН рокропройрпНрокроЯрпБроХро┐ро▒родрпБ рооро▒рпНро▒рпБроорпН роЪро┐ро▒роирпНрод роХcooling родро░рпБроХро┐ро▒родрпБ"],
          hi: ["ЁЯМА рд╕реАрд▓рд┐рдВрдЧ рдлреИрди рдпрд╛ BLDC рдлреИрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ", "тЬЕ рдпрд╣ рдХрдо рдмрд┐рдЬрд▓реА рдЦрдкрдд рдХрд░рддрд╛ рд╣реИ рдФрд░ рдмреЗрд╣рддрд░ рдардВрдбрдХ рджреЗрддрд╛ рд╣реИ"]
        }
      },
      {
        keywords: ["what light to use", "best light", "light type"],
        reply: {
          en: ["ЁЯТб Use LED bulbs instead of incandescent or CFL", "тЬЕ LEDs consume less power and last longer"],
          ta: ["ЁЯТб роЗройрпНроХро╛ройрпНроЯро╕ройрпНроЯрпН роЕро▓рпНро▓родрпБ CFL рокродро┐ро▓ро╛роХ LED ро╡ро┐ро│роХрпНроХрпБроХро│рпН рокропройрпНрокроЯрпБродрпНродро╡рпБроорпН", "тЬЕ LED роХроорпНрокро┐роХро│рпН роХрпБро▒рпИроирпНрод рооро┐ройрпНроЪро╛ро░роорпН рокропройрпНрокроЯрпБродрпНродрпБроХро┐ро▒родрпБ рооро▒рпНро▒рпБроорпН роирпАрогрпНроЯ роХро╛ро▓роорпН роирпАроЯро┐роХрпНроХрпБроорпН"],
          hi: ["ЁЯТб рдЗрдирдХреИрдВрдбреЗрд╕реЗрдВрдЯ рдпрд╛ CFL рдХреЗ рдмрдЬрд╛рдп LED рдмрд▓реНрдм рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ", "тЬЕ LEDs рдХрдо рдмрд┐рдЬрд▓реА рдЦрдкрдд рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рд▓рдВрдмреЗ рд╕рдордп рддрдХ рдЪрд▓рддреЗ рд╣реИрдВ"]
        }
      },
      {
        keywords: ["tv electricity", "what tv to use", "tv energy saving"],
        reply: {
          en: ["ЁЯУ║ Use LED or Smart TVs with energy-saving mode", "тЬЕ Avoid leaving TV on standby for long periods"],
          ta: ["ЁЯУ║ роОро░рпНроЬро┐ роЪрпЗрооро┐рокрпНрокрпБ роорпБро▒рпИ роХрпКрогрпНроЯ LED роЕро▓рпНро▓родрпБ ро╕рпНрооро╛ро░рпНроЯрпН TV рокропройрпНрокроЯрпБродрпНродро╡рпБроорпН", "тЬЕ TV ро╕рпНроЯрпЗрогрпНроЯрпНрокрпИ роЕройро╛ро╡роЪро┐ропрооро╛роХ роирпАрогрпНроЯ роирпЗро░роорпН ро╡рпИроХрпНроХро╛родрпАро░рпНроХро│рпН"],
          hi: ["ЁЯУ║ рдКрд░реНрдЬрд╛ рдмрдЪрд╛рдиреЗ рд╡рд╛рд▓реЗ рдореЛрдб рдХреЗ рд╕рд╛рде LED рдпрд╛ рд╕реНрдорд╛рд░реНрдЯ TV рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ", "тЬЕ TV рдХреЛ рд╕реНрдЯреИрдВрдбрдмрд╛рдп рдореЗрдВ рд▓рдВрдмреЗ рд╕рдордп рддрдХ рди рдЫреЛрдбрд╝реЗрдВ"]
        }
      },
      {
        keywords: ["hi", "hello", "hey"],
        reply: {
          en: ["ЁЯСЛ Hey! How are you?"],
          ta: ["ЁЯСЛ ро╣ро╛ропрпН! роОрокрпНрокроЯро┐ роЗро░рпБроХрпНроХрпАро░рпНроХро│рпН?"],
          hi: ["ЁЯСЛ рд╣рд╛рдп! рдЖрдк рдХреИрд╕реЗ рд╣реИрдВ?"]
        }
      },
      {
        keywords: ["fine", "I am fine"],
        reply: {
          en: ["ЁЯШК That's good to hear!"]
        }
      },
      {
        keywords: ["how are you", "what about you"],
        reply: {
          en: ["ЁЯдЦ I'm doing great! How about you?"],
          ta: ["ЁЯдЦ роиро╛ройрпН роиройрпНро▒ро╛роХ роЗро░рпБроХрпНроХро┐ро▒рпЗройрпН! роирпАроЩрпНроХро│рпН роОрокрпНрокроЯро┐ роЗро░рпБроХрпНроХро┐ро▒рпАро░рпНроХро│рпН?"],
          hi: ["ЁЯдЦ рдореИрдВ рдареАрдХ рд╣реВрдБ! рдЖрдк?"]
        }
      },
      {
        keywords: ["what is your name"],
        reply: {
          en: ["ЁЯТб I am Energy Saver Bot"],
          ta: ["ЁЯТб роиро╛ройрпН роОро░рпНроЬро┐ роЪрпЗро╡ро░рпН рокро╛роЯрпНроЯро╛"],
          hi: ["ЁЯТб рдореИрдВ рдПрдирд░реНрдЬреА рд╕реЗрд╡рд░ рдмреЙрдЯ рд╣реВрдБ"]
        }
      },
      {
        keywords: ["thanks", "thank you"],
        reply: {
          en: ["ЁЯШК You're welcome!"],
          ta: ["ЁЯШК роирпАроЩрпНроХро│рпН ро╡ро░ро╡рпЗро▒рпНроХрокрпНрокроЯрпБроХро┐ро▒рпАро░рпНроХро│рпН!"],
          hi: ["ЁЯШК рдЖрдкрдХрд╛ рд╕реНрд╡рд╛рдЧрдд рд╣реИ!"]
        }
      },
      {
        keywords: ["rooftop solar", "solar benefits", "solar subsidy", "solar contact", "solar installation"],
        reply: {
          en: [
            "ЁЯМЮ Benefits of Rooftop Solar Systems:",
            "тЬЕ Reduces electricity bills significantly",
            "тЬЕ Environment-friendly, reduces carbon footprint",
            "тЬЕ Energy independence and backup during power cuts",
            "ЁЯТ╕ Subsidy: Up to 40% subsidy is provided by MNRE (Ministry of New and Renewable Energy)",
            "ЁЯУЮ Contact TANGEDCO for installation assistance: 1800-425-1234",
            "ЁЯФЧ More details: https://mnre.gov.in/solar-rooftop"
          ],
          ta: [
            "ЁЯМЮ роХрпВро░рпИ роЪрпЛро▓ро╛ро░рпН роЕроорпИрокрпНрокрпБроХро│ро┐ройрпН роиройрпНроорпИроХро│рпН:",
            "тЬЕ рооро┐ройрпНроЪро╛ро░роХрпН роХроЯрпНроЯрогродрпНродрпИ роХрпБро▒рпИроХрпНроХро┐ро▒родрпБ",
            "тЬЕ роЪрпБро▒рпНро▒рпБроЪрпНроЪрпВро┤ро▓рпБроХрпНроХрпБ роиро▓рпНро▓родрпБ, роХро╛ро░рпНрокройрпН роЕроЯрпИропро╛ро│родрпНродрпИ роХрпБро▒рпИроХрпНроХро┐ро▒родрпБ",
            "тЬЕ рооро┐ройрпНро╡ро┐ро│роХрпНроХроЩрпНроХро│рпН роорпБроЯроХрпНроХрокрпНрокроЯрпНроЯро╛ро▓рпБроорпН роЖро▒рпНро▒ро▓рпН роЪрпБропро╛родрпАройроорпН",
            "ЁЯТ╕ рооро╛ройро┐ропроорпН: MNRE роорпВро▓роорпН 40% ро╡ро░рпИ рооро╛ройро┐ропроорпН ро╡ро┤роЩрпНроХрокрпНрокроЯрпБроХро┐ро▒родрпБ",
            "ЁЯУЮ роиро┐ро▒рпБро╡ роЙродро╡ро┐: TANGEDCO 1800-425-1234",
            "ЁЯФЧ роорпЗро▓рпБроорпН ро╡ро┐ро╡ро░роЩрпНроХро│рпБроХрпНроХрпБ: https://mnre.gov.in/solar-rooftop"
          ],
          hi: [
            "ЁЯМЮ рд░реВрдлрдЯреЙрдк рд╕реЛрд▓рд░ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рдлрд╛рдпрджреЗ:",
            "тЬЕ рдмрд┐рдЬрд▓реА рдмрд┐рд▓ рдореЗрдВ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдмрдЪрдд",
            "тЬЕ рдкрд░реНрдпрд╛рд╡рд░рдг рдХреЗ рдЕрдиреБрдХреВрд▓, рдХрд╛рд░реНрдмрди рдлреБрдЯрдкреНрд░рд┐рдВрдЯ рдХрдо рдХрд░рддрд╛ рд╣реИ",
            "тЬЕ рдмрд┐рдЬрд▓реА рдХрдЯреМрддреА рдХреЗ рд╕рдордп рдмреИрдХрдЕрдк рдФрд░ рдКрд░реНрдЬрд╛ рдЖрддреНрдордирд┐рд░реНрднрд░рддрд╛",
            "ЁЯТ╕ рд╕рдмреНрд╕рд┐рдбреА: MNRE рд╕реЗ 40% рддрдХ рд╕рдмреНрд╕рд┐рдбреА",
            "ЁЯУЮ рдЗрдВрд╕реНрдЯреЙрд▓реЗрд╢рди рд╕рд╣рд╛рдпрддрд╛ рдХреЗ рд▓рд┐рдП рд╕рдВрдкрд░реНрдХ рдХрд░реЗрдВ: TANGEDCO 1800-425-1234",
            "ЁЯФЧ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА: https://mnre.gov.in/solar-rooftop"
          ]
        }
      }
    ];

    const chatBox = document.getElementById('chatBox');
    const chatInput = document.getElementById('chatInput');
    const sendBtn = document.getElementById('sendBtn');
    const langSelect = document.getElementById('langSelect');

    function levenshtein(a, b) {
      const dp = Array.from({ length: a.length + 1 }, () => Array(b.length + 1).fill(0));
      for (let i = 0; i <= a.length; i++) dp[i][0] = i;
      for (let j = 0; j <= b.length; j++) dp[0][j] = j;
      for (let i = 1; i <= a.length; i++) {
        for (let j = 1; j <= b.length; j++) {
          dp[i][j] = a[i - 1] === b[j - 1] ? dp[i - 1][j - 1] : Math.min(dp[i - 1][j - 1], dp[i - 1][j], dp[i][j - 1]) + 1;
        }
      }
      return dp[a.length][b.length];
    }

    function findBestMatch(text) {
      text = text.toLowerCase().trim();
      let best = null, minDist = Infinity;
      for (const item of responses) {
        for (const k of item.keywords) {
          const keyword = k.toLowerCase();
          if (text.includes(keyword) || keyword.includes(text)) return item;
          const dist = levenshtein(text, keyword);
          if (dist <= Math.min(keyword.length / 2, 3) && dist < minDist) {
            minDist = dist;
            best = item;
          }
        }
      }
      return best;
    }

    function appendMessage(sender, text) {
      const msg = document.createElement('div');
      msg.className = 'message ' + sender;
      msg.innerText = text;
      chatBox.appendChild(msg);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    function typeMessage(replyArr) {
      const typing = document.createElement('div');
      typing.className = 'typing';
      typing.innerText = 'Energy Bot is typing...';
      chatBox.appendChild(typing);
      chatBox.scrollTop = chatBox.scrollHeight;
      setTimeout(() => {
        chatBox.removeChild(typing);
        replyArr.forEach((line, i) =>
          setTimeout(() => appendMessage('bot', line), i * 1200)
        );
      }, 1000);
    }

    function sendMessage() {
      const text = chatInput.value.trim();
      if (!text) return;
      appendMessage('user', text);
      chatInput.value = '';
      const lang = langSelect.value;
      const matched = findBestMatch(text);
      if (matched) {
        typeMessage(matched.reply[lang] || matched.reply['en']);
      } else {
        const fallback = {
          en: "тЭУ I'm not sure about that. Try asking: 'How to save electricity?'",
          ta: "тЭУ роиро╛ройрпН роЕродро┐ро▓рпН роиро┐роЪрпНроЪропроорпН роЗро▓рпНро▓рпИ. роХрпЗро│рпБроЩрпНроХро│рпН: 'рооро┐ройрпНроЪро╛ро░родрпНродрпИ роОрокрпНрокроЯро┐ роЪрпЗрооро┐рокрпНрокродрпБ?'",
          hi: "тЭУ рдореБрдЭреЗ рдЗрд╕рдХрд╛ рдкрддрд╛ рдирд╣реАрдВ рд╣реИред рдкреВрдЫреЗрдВ: 'рдмрд┐рдЬрд▓реА рдХреИрд╕реЗ рдмрдЪрд╛рдПрдВ?'"
        };
        appendMessage('bot', fallback[lang]);
      }
    }

    sendBtn.addEventListener('click', sendMessage);
    chatInput.addEventListener('keypress', e => {
      if (e.key === 'Enter') sendMessage();
    });

  </script>

</body>
</html>
